{{define "audioSettings"}}

<!-- Hidden input to always submit the template name -->
<input type="hidden" name="templateName" value="{{.TemplateName}}">

<!-- Audio Capture Settings start -->
<div class="collapse collapse-open bg-base-100 shadow-xs col-span-3"
x-data="{ 
    audioCapture: {
        source: '{{.Settings.Realtime.Audio.Source}}',
        rtsp: {
            transport: '{{.Settings.Realtime.RTSP.Transport}}',
            urls: {{if .Settings.Realtime.RTSP.URLs}}{{.Settings.Realtime.RTSP.URLs | toJSON}}{{else}}[]{{end}}
        },
        equalizer: {
            enabled: {{.Settings.Realtime.Audio.Equalizer.Enabled}},
            filters: [
                {{range .Settings.Realtime.Audio.Equalizer.Filters}}
                {
                    type: '{{.Type}}',
                    frequency: {{.Frequency}},
                    q: {{.Q}},
                    gain: {{.Gain}},
                    passes: {{.Passes}}
                },
                {{end}}
            ]
        },
        eqFilterConfig: {{.EqFilterConfig | toJSON}},
    },
    audioDevices: [],
    selectedDeviceIndex: -1,
    audioCaptureSettingsOpen: false,
    showTooltip: null,
    hasChanges: false,
    newUrl: '',
    editIndex: null,
    editUrl: '',
    newFilter: {
        type: '',
        frequency: 0,
        q: 0,
        gain: 0,
        passes: 0
    },
    resetChanges() {
        this.hasChanges = false;
    },
    addUrl() {
        if (this.newUrl) {
            this.audioCapture.rtsp.urls.push(this.newUrl);
            this.newUrl = '';
            this.hasChanges = true;
        }
    },
    removeUrl(index) {
        this.audioCapture.rtsp.urls.splice(index, 1);
        this.hasChanges = true;
    },
    fetchAudioDevices() {
        fetch('/settings/audio/get')
            .then(response => response.json())
            .then(data => {
                this.audioDevices = data;
            })
            .catch(error => console.error('Error fetching audio devices:', error));
    },
    getEqFilterParameters(filterType) {
        return this.audioCapture.eqFilterConfig[filterType]?.Parameters || [];
    },
    getEqFilterTooltip(filterType) {
        return this.audioCapture.eqFilterConfig[filterType]?.Tooltip || '';
    },
    addNewFilter() {
        if (this.newFilter.type) {
            this.audioCapture.equalizer.filters.push({...this.newFilter});
            this.newFilter = { type: '', frequency: 0, q: 0, gain: 0, passes: 0 };
            this.hasChanges = true;
        }
    },
    getFilterDefaults(filterType) {
        if (this.newFilter.type) {
            this.getEqFilterParameters(this.newFilter.type).forEach(param => {
                this.newFilter[param.Name.toLowerCase()] = param.Default;
            });
        } else {
            this.newFilter = { type: '', frequency: 0, q: 0, gain: 0, passes: 0 };
        }
    },
    removeFilter(index) {
        this.audioCapture.equalizer.filters.splice(index, 1);
        this.hasChanges = true;
    }
}"
x-init="
    $watch('audioCapture', (value) => { hasChanges = true }, { deep: true });
    fetchAudioDevices();
">

    <!-- control collapse element open state and label visibility -->
    <input type="checkbox" id="audioCaptureSettingsOpen" x-on:change="audioCaptureSettingsOpen = !audioCaptureSettingsOpen" />

    <div class="collapse-title text-xl font-medium">
        <div class="flex items-center">
            <label for="audioCaptureSettingsOpen" class="cursor-pointer">Audio Capture</label>
            <div x-show="hasChanges" x-cloak class="ml-2">
                <span class="badge badge-primary badge-sm changed-badge">
                    <span class="text-xs mb-0.5">changed</span>
                </span>
            </div>
        </div>
        <!-- short descripton of this section -->
        <p class="text-sm text-gray-500">Set audio capture source, sound card or RTSP stream</p>
    </div>

    <div class="collapse-content">

        <div class="text-lg font-medium pb-2">Sound Card Source</div>

        <div class="form-control relative">
            <label class="label justify-start" for="audioSource">
                <span class="label-text">Audio Source</span>
                <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioSource'" @mouseleave="showTooltip = null">ⓘ</span>
            </label>
            <!--<input type="text" id="audioSource" name="realtime.audio.source" x-model="audioCapture.source" class="input input-bordered input-sm w-full" :disabled="audioCapture.rtsp.urls.length > 0">-->
            <select x-model="audioCapture.source"
                    name="realtime.audio.source"
                    class="select select-bordered select-sm w-full"
                    :disabled="audioCapture.rtsp.urls.length > 0">
                <option value="">Select an audio source</option>
                <template x-for="device in audioDevices" :key="device.Index">
                    <option :value="device.Name" x-text="device.Name"></option>
                </template>
            </select>
            <div x-show="showTooltip === 'audioSource'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                Audio source to use for analysis (e.g., 'sysdefault'). This setting is disabled if RTSP URLs are configured.
            </div>
        </div>

        <!-- RTSP Source start -->
        <div class="text-lg font-medium pt-4 pb-2">RTSP Source</div>

        <div class="form-control relative">
            <label class="label justify-start" for="rtspTransport">
                <span class="label-text">RTSP Transport Protocol</span>
                <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'rtspTransport'" @mouseleave="showTooltip = null">ⓘ</span>
            </label>
            <select id="rtspTransport" name="realtime.rtsp.transport" x-model="audioCapture.rtsp.transport" class="select select-bordered select-sm w-full">
                <option value="tcp">TCP</option>
                <option value="udp">UDP</option>
            </select>
            <div x-show="showTooltip === 'rtspTransport'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                Choose the RTSP transport protocol.
            </div>
        </div>

        <!-- RTSP Stream URLs start -->
        <div class="form-control relative">
            <label class="label justify-start" for="rtspUrls">
                <span class="label-text mt-2">RTSP Stream URLs</span>
                <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'rtspUrls'" @mouseleave="showTooltip = null">ⓘ</span>
            </label>
        
            <template x-for="(url, index) in audioCapture.rtsp.urls" :key="index">
                <div class="flex items-center mb-2">
                    <input type="text" :name="'realtime.rtsp.urls[' + index + ']'" x-model="audioCapture.rtsp.urls[index]" class="input input-bordered input-sm w-full mr-2">
                    <button type="button" @click="removeUrl(index)" class="btn btn-error btn-xs">Remove</button>
                </div>
            </template>

            <div x-show="showTooltip === 'rtspUrls'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                Add or remove RTSP stream URLs. (rtsp://user:password@example.com/stream1)
            </div>

            <!-- Add new RTSP URL button -->
            <div class="flex items-center mt-2">
                <input type="text" x-model="newUrl" class="input input-bordered input-sm w-full mr-2" placeholder="Enter RTSP URL (rtsp://user:password@example.com/stream1)">
                <button type="button" class="btn btn-primary btn-sm" @click="addUrl">Add</button>
            </div>

            <!-- Hidden input to always submit the RTSP URLs, even when empty -->
            <input type="hidden" name="realtime.rtsp.urls" :value="JSON.stringify(audioCapture.rtsp.urls)">
        </div>
        <!-- RTSP Source end -->

        <!-- Audio Filters start -->
        <div class="text-lg font-medium pt-4 pb-2">Audio Filters</div>

        <div class="form-control relative">
            <label class="label justify-start" for="audioFiltersEnabled">
                <input type="checkbox" id="audioFiltersEnabled" name="realtime.audio.equalizer.enabled" x-model="audioCapture.equalizer.enabled" class="checkbox checkbox-primary checkbox-xs mr-2">
                <input type="hidden" name="realtime.audio.equalizer.enabled" value="false">
                <span class="label-text">Enable Audio Equalizer</span>
                <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioEqualizerEnabled'" @mouseleave="showTooltip = null">ⓘ</span>
            </label>
            <div x-show="showTooltip === 'audioEqualizerEnabled'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                Enable or disable audio equalizer.
            </div>
            
            <div x-show="audioCapture.equalizer.enabled" x-cloak>
                <!-- Existing filters -->
                <template x-for="(filter, index) in audioCapture.equalizer.filters" :key="index">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 items-end mt-2 bg-gray-50 rounded-md p-2" x-data="{ hasFilterChanges: false }">

                        <div class="relative flex items-end">
                            <input type="hidden" :name="'realtime.audio.equalizer.filters['+index+'].type'" :value="filter.type">
                            <button type="button" class="btn btn-sm w-full bg-slate-300 pointer-events-none select-none">
                                <span class="font-medium" x-text="filter.type + ' Filter'"></span>
                            </button>
                        </div>

                        <!-- Existing Audio Filter Parameters -->
                        <template x-for="param in getEqFilterParameters(filter.type)" :key="param.Name">
                            <div class="flex flex-col items-end">
                                <label class="label pt-0">
                                    <span class="label-text-alt" x-text="param.Label + (param.Unit ? ' (' + param.Unit + ')' : '')"></span>
                                    <span class="ml-2 text-sm text-gray-500 cursor-help"
                                          @mouseenter="showTooltip = param.Tooltip"
                                          @mouseleave="showTooltip = null">ⓘ</span>
                                </label>
                                <!-- Select for Attenuation -->
                                <template x-if="param.Label === 'Attenuation'">
                                    <select x-model.number="filter[param.Name.toLowerCase()]"
                                            :name="'realtime.audio.equalizer.filters['+index+'].'+param.Name.toLowerCase()"
                                            class="select select-bordered select-sm w-full"
                                            @change="hasFilterChanges = true">
                                        <option value="0">0dB</option>
                                        <option value="1">12dB</option>
                                        <option value="2">24dB</option>
                                        <option value="3">36dB</option>
                                        <option value="4">48dB</option>
                                    </select>
                                </template>
                                <!-- Input for other parameters -->
                                <template x-if="param.Label !== 'Attenuation'">
                                    <input x-model.number="filter[param.Name.toLowerCase()]"
                                           :name="'realtime.audio.equalizer.filters['+index+'].'+param.Name.toLowerCase()"
                                           :type="param.Type === 'float' ? 'number' : param.Type"
                                           :step="param.Type === 'float' ? '0.1' : '1'"
                                           :min="param.Min"
                                           :max="param.Max"
                                           class="input input-bordered input-sm w-full"
                                           @input="hasFilterChanges = true">
                                </template>
                            </div>
                        </template>

                        <!-- Remove filter button -->
                        <div class="relative flex items-end md:justify-end md:col-start-5">
                            <button type="button" @click="removeFilter(index)" class="btn btn-error btn-sm w-full md:w-24">Remove</button>
                        </div>
                    </div>
                </template>

                <!-- Add new filter -->
            
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 items-end mt-6">
                    <!-- New Filter Type -->
                    <div class="flex flex-col">
                        <label class="label">
                            <span class="label-text">New Filter Type</span>
                        </label>
                        <select x-model="newFilter.type" 
                                @change="getFilterDefaults(newFilter.type)"
                                class="select select-bordered select-sm w-full">
                            <option value="">Select filter type</option>
                            <template x-for="(config, type) in audioCapture.eqFilterConfig" :key="type">
                                <option :value="type" x-text="type"></option>
                            </template>
                        </select>
                    </div>
                    
                    <!-- New Audio Filter Parameters -->
                    <template x-if="newFilter.type">
                        <template x-for="param in getEqFilterParameters(newFilter.type)" :key="param.Name">
                            <div class="flex flex-col">
                                <label class="label">
                                    <span class="label-text" x-text="param.Label + (param.Unit ? ' (' + param.Unit + ')' : '')"></span>
                                    <span class="ml-2 text-sm text-gray-500 cursor-help"
                                          @mouseenter="showTooltip = param.Tooltip"
                                          @mouseleave="showTooltip = null">ⓘ</span>
                                </label>
                                <!-- Select for Attenuation -->
                                <template x-if="param.Label === 'Attenuation'">
                                    <select x-model.number="newFilter[param.Name.toLowerCase()]"
                                            class="select select-bordered select-sm w-full">
                                        <option value="0">0dB</option>
                                        <option value="1">12dB</option>
                                        <option value="2">24dB</option>
                                        <option value="3">36dB</option>
                                        <option value="4">48dB</option>
                                    </select>
                                </template>
                                <!-- Input for other parameters -->
                                <template x-if="param.Name !== 'Passes'">
                                    <input x-model.number="newFilter[param.Name.toLowerCase()]"
                                           :type="param.Type === 'float' ? 'number' : param.Type"
                                           :step="param.Type === 'float' ? '0.1' : '1'"
                                           :min="param.Min"
                                           :max="param.Max"
                                           class="input input-bordered input-sm w-full">
                                </template>
                            </div>
                        </template>
                    </template>
                
                    <!-- Add new filter button -->
                    <div class="flex flex-col">
                        <label class="label">
                            <span class="label-text">&nbsp;</span>
                        </label>
                        <button type="button" @click="addNewFilter" class="btn btn-primary btn-sm w-24" x-bind:disabled="!newFilter.type">
                            Add Filter
                        </button>
                    </div>
                    
                </div>

            </div>
        </div>
        <!-- Audio Filters end -->

    </div>
</div>
<!-- Audio Capture Settings end -->

<!-- Audio Export Settings start -->
<div class="collapse collapse-open bg-base-100 shadow-xs col-span-3"
     x-data="{ 
         audioExport: {
             enabled: {{.Settings.Realtime.Audio.Export.Enabled}},
             debug: {{.Settings.Realtime.Audio.Export.Debug}},
             path: '{{.Settings.Realtime.Audio.Export.Path}}',
             type: '{{.Settings.Realtime.Audio.Export.Type}}',
             bitrate: '{{.Settings.Realtime.Audio.Export.Bitrate}}'
         },
         ffmpegAvailable: {{if ffmpegAvailable}}true{{else}}false{{end}},
         audioExportSettingsOpen: false,
         showTooltip: null,
         hasChanges: false,
         resetChanges() {
             this.hasChanges = false;
         }
     }"
     x-init="
         $watch('audioExport', (value) => { hasChanges = true }, { deep: true });
         if (!ffmpegAvailable && audioExport.type !== 'wav') {
            audioExport.type = 'wav';
         }
     ">
    <input type="checkbox" id="audioExportSettingsOpen" x-on:change="audioExportSettingsOpen = !audioExportSettingsOpen" />
    <div class="collapse-title text-xl font-medium">
        <div class="flex items-center">
            <label for="audioExportSettingsOpen" class="cursor-pointer">Audio Export</label>
            <div x-show="hasChanges" x-cloak class="ml-2">
                <span class="badge badge-primary badge-sm changed-badge">
                    <span class="text-xs mb-0.5">changed</span>
                </span>
            </div>
        </div>
        <!-- short descripton of this section -->
        <p class="text-sm text-gray-500">Configure audio clip saving for identified bird calls</p>
    </div>

    <div class="collapse-content">
        <div class="form-control relative">
            <label class="label cursor-pointer justify-start" for="audioExportEnabled">
                <input type="checkbox" id="audioExportEnabled" name="realtime.audio.export.enabled" x-model="audioExport.enabled" class="checkbox checkbox-primary checkbox-xs mr-2">
                <input type="hidden" name="realtime.audio.export.enabled" value="false">
                <span class="label-text">Enable Audio Export</span>
                <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioExportEnabled'" @mouseleave="showTooltip = null">ⓘ</span>
            </label>
            <div x-show="showTooltip === 'audioExportEnabled'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                Enable or disable audio export for identified bird calls.
            </div>
        </div>

        <div x-show="audioExport.enabled">
            <div class="form-control relative">
                <label class="label cursor-pointer justify-start" for="audioExportDebug">
                    <input type="checkbox" id="audioExportDebug" name="realtime.audio.export.debug" x-model="audioExport.debug" class="checkbox checkbox-primary checkbox-xs mr-2">
                    <input type="hidden" name="realtime.audio.export.debug" value="false">
                    <span class="label-text">Enable Debug Mode</span>
                    <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioExportDebug'" @mouseleave="showTooltip = null">ⓘ</span>
                </label>
                <div x-show="showTooltip === 'audioExportDebug'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                    Enable debug mode for audio export.
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="form-control relative">
                    <label class="label justify-start" for="audioExportPath">
                        <span class="label-text">Export Path</span>
                        <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioExportPath'" @mouseleave="showTooltip = null">ⓘ</span>
                    </label>
                    <input type="text" id="audioExportPath" name="realtime.audio.export.path" x-model="audioExport.path" class="input input-bordered input-sm w-full">
                    <div x-show="showTooltip === 'audioExportPath'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                        Path to the audio clip export directory.
                    </div>
                </div>

                <div class="form-control relative">
                    <label class="label justify-start" for="audioExportType">
                        <span class="label-text">Export Type</span>
                        <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioExportType'" @mouseleave="showTooltip = null">ⓘ</span>
                    </label>                  
                    <select id="audioExportType" name="realtime.audio.export.type" 
                            x-model="audioExport.type" 
                            class="select select-bordered select-sm w-full"
                            :disabled="!ffmpegAvailable">
                        <option value="wav">wav</option>
                        <option value="flac" x-show="ffmpegAvailable">flac</option>
                        <option value="aac" x-show="ffmpegAvailable">aac</option>
                        <option value="opus" x-show="ffmpegAvailable">opus</option>
                        <option value="mp3" x-show="ffmpegAvailable">mp3</option>
                    </select>
                    <div x-show="showTooltip === 'audioExportType'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                        Type of audio file to export. AAC is recommended for general use, it has good compression and is widely supported. MP3 only for legacy reasons. FFmpeg is required for formats other than WAV.
                    </div>
                </div>

                <div class="form-control relative">
                    <label class="label justify-start" for="audioExportBitrate">
                        <span class="label-text">Bitrate</span>
                        <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioExportBitrate'" @mouseleave="showTooltip = null">ⓘ</span>
                    </label>
                    <input type="text" id="audioExportBitrate" name="realtime.audio.export.bitrate" 
                           x-model="audioExport.bitrate.endsWith('k') ? audioExport.bitrate : audioExport.bitrate + 'k'" 
                           class="input input-bordered input-sm w-full" 
                           placeholder="Bitrate (e.g. 128k)"
                           :disabled="!ffmpegAvailable || !['aac', 'opus', 'mp3'].includes(audioExport.type)"
                           :class="{'opacity-50 cursor-not-allowed': !ffmpegAvailable || !['aac', 'opus', 'mp3'].includes(audioExport.type)}"
                           @input="if (!$event.target.value.endsWith('k')) $event.target.value += 'k'">
                    <div x-show="showTooltip === 'audioExportBitrate'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                        Bitrate for compressed audio export in kbps. Only applicable for AAC, Opus, and MP3 formats when FFmpeg is available.
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<!-- Audio Export Settings end -->

<!-- Audio Retention Settings start -->
<div class="collapse collapse-open bg-base-100 shadow-xs col-span-3"
     x-data="{ 
         audioRetention: {
             policy: '{{.Settings.Realtime.Audio.Export.Retention.Policy}}',
             maxage: '{{.Settings.Realtime.Audio.Export.Retention.MaxAge}}',
             maxusage: '{{.Settings.Realtime.Audio.Export.Retention.MaxUsage}}',
             minclips: {{.Settings.Realtime.Audio.Export.Retention.MinClips}}
         },
         audioRetentionSettingsOpen: false,
         showTooltip: null,
         hasChanges: false,
         resetChanges() {
             this.hasChanges = false;
         }
     }"
     x-init="
         $watch('audioRetention', (value) => { hasChanges = true }, { deep: true });
     ">
    <input type="checkbox" id="audioRetentionSettingsOpen" x-on:change="audioRetentionSettingsOpen = !audioRetentionSettingsOpen" />
    <div class="collapse-title text-xl font-medium">
        <div class="flex items-center">
            <label for="audioRetentionSettingsOpen" class="cursor-pointer">Audio Clip Retention</label>
            <div x-show="hasChanges" x-cloak class="ml-2">
                <span class="badge badge-primary badge-sm changed-badge">
                    <span class="text-xs mb-0.5">changed</span>
                </span>
            </div>
        </div>
        <!-- short descripton of this section -->
        <p class="text-sm text-gray-500">Configure audio clip cleanup</p>
    </div>

    <div class="collapse-content">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-control relative">
                <label class="label justify-start" for="audioRetentionPolicy">
                    <span class="label-text">Retention Policy</span>
                    <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioRetentionPolicy'" @mouseleave="showTooltip = null">ⓘ</span>
                </label>
                <select id="audioRetentionPolicy" name="realtime.audio.export.retention.policy" x-model="audioRetention.policy" class="select select-bordered select-sm w-full">
                    <option value="none">None</option>
                    <option value="age">Age</option>
                    <option value="usage">Usage</option>
                </select>
                <div x-show="showTooltip === 'audioRetentionPolicy'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                    Retention policy for audio clips.
                </div>
            </div>

            <div class="form-control relative" x-show="audioRetention.policy === 'age'">
                <label class="label justify-start" for="audioRetentionMaxAge">
                    <span class="label-text">Max Age (h for hours, d for days, w for weeks, m for months, y for years)</span>
                    <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioRetentionMaxAge'" @mouseleave="showTooltip = null">ⓘ</span>
                </label>
                <input type="text" id="audioRetentionMaxAge" name="realtime.audio.export.retention.maxage" x-model="audioRetention.maxage" class="input input-bordered input-sm w-full">
                <div x-show="showTooltip === 'audioRetentionMaxAge'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                    Maximum age of clips to keep before starting evictions.
                </div>
            </div>

            <div class="form-control relative" x-show="audioRetention.policy === 'usage'">
                <label class="label justify-start" for="audioRetentionMaxUsage">
                    <span class="label-text">Max Usage (percentage)</span>
                    <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioRetentionMaxUsage'" @mouseleave="showTooltip = null">ⓘ</span>
                </label>
                <input type="text" id="audioRetentionMaxUsage" name="realtime.audio.export.retention.maxusage" x-model="audioRetention.maxusage"
                @input="if (!audioRetention.maxusage.endsWith('%') && !isNaN(audioRetention.maxusage)) audioRetention.maxusage += '%'"
                class="input input-bordered input-sm w-full">

                <div x-show="showTooltip === 'audioRetentionMaxUsage'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                    Maximum disk usage percentage or size to trigger evictions (e.g., '80%').
                </div>
            </div>

            <div class="form-control relative" x-show="audioRetention.policy !== 'none'">
                <label class="label justify-start" for="audioRetentionMinClips">
                    <span class="label-text">Minimum Clips</span>
                    <span class="ml-2 text-sm text-gray-500 cursor-help" @mouseenter="showTooltip = 'audioRetentionMinClips'" @mouseleave="showTooltip = null">ⓘ</span>
                </label>
                <input type="number" id="audioRetentionMinClips" name="realtime.audio.export.retention.minclips" x-model="audioRetention.minclips" min="1" class="input input-bordered input-sm w-full">
                <div x-show="showTooltip === 'audioRetentionMinClips'" x-cloak class="absolute left-0 bottom-full mb-2 p-2 bg-gray-100 text-sm rounded shadow-md z-50">
                    Minimum number of clips per species to keep before starting evictions.
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Audio Retention Settings end -->

{{end}}